<!DOCTYPE html>
<html>
<head>
	<title>Media Player PNaCl</title>
     <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
  <link rel="stylesheet" href="map/leaflet/leaflet.css">

  <!-- Compiled and minified JavaScript -->
 
    <link href="vxgplayer-1.8.31.min.css" rel="stylesheet"/> 
    
    
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        padding: 0;
        margin: 0;
        height: 35%;
        width: 30%;
        z-index: 5;
        top: 55%;
        left: 70%;
        position: absolute;
      }
        
            
/* Taskbar */
        #navlist li
{
display: inline;
list-style-type: none;
padding-right: 20px;
z-index: 6;
    border: 1px solid #1b9bd8;

}
        #navcontainer{
            top:90%;
            width:100%;
            z-index: 6;
            position: absolute;
        }
      #powergraph {
        top:10%;
        height: 30%;
        width: 30%;
        
        z-index: 5;
        left: 0%;
        position: absolute;
      }
        #dropdown1{
            position: absolute;
            z-index: 7;
        }
        
        #arm {
        top:60%;
          height: 40%;
        width: 16%;
        z-index: 5;
        left: 75%;
        position: absolute;
      }
    
        #armbase{
            top:50%;
            height: 10%;
             z-index: 5;
            
        left: 88%;
        position: absolute;
        }
        
        #firstarm{
            top:44.25%;
            height: 10%;
             z-index: 5;
              
        left: 85.5%;
        position: absolute;
            transform-origin: bottom right;
            -ms-transform: rotate(46deg); /* IE 9 */
    -webkit-transform: rotate(46deg); /* Chrome, Safari, Opera */
    transform: rotate(46deg);

        }
        
          #secondarm{
            top:35.2%;
            height: 10%;
             z-index: 5;
              
        left: 85.3%;
        position: absolute;
            transform-origin: bottom right;
            -ms-transform: rotate(46deg); /* IE 9 */
    -webkit-transform: rotate(46deg); /* Chrome, Safari, Opera */
    transform: rotate(46deg);

        }
        
      #task_border {
        height: 65%;
        width: 20%;
        z-index: 5;
        position: absolute;
            
      }
        
     .task_item {
        height: 10%;
        width: 18%;
        z-index: 3;
        position: absolute;
            
      }
      .vxgplayer {
        z-index: 0;
        left: 0%;
        max-height: 80%;
        max-width: 100%;
        margin-left: 0%;
        margin-top: 0%;
        margin-right: 0%;
        margin-bottom: 0%;
        position: fixed;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        margin: 0;
        padding: 0;
          width:100%;
          height:100%;
          background-color: black;
      }
        
        
      /* Cube */
    *, *:before, *:after {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
        }


#wrapper {
  height: 15%;
  width: 15%;
  top: 15%;
  left: 80%;
  z-index: 5;
            position: absolute;

}

.viewport {
    
  -webkit-perspective: 20%;
  -moz-perspective: 20%;
  -ms-perspective: 20%;
  -o-perspective: 20%;
  perspective: 20%;
  -webkit-perspective-origin: 20%;
  -moz-perspective-origin: 20%;
  -ms-perspective-origin: 20%;
  -o-perspective-origin: 50% 200px;
  perspective-origin: 50% 200px;
  -webkit-transform: scale(0.5, 0.5);
  -moz-transform: scale(0.5, 0.5);
  -ms-transform: scale(0.5, 0.5);
  -o-transform: scale(0.5, 0.5);
  transform: scale(0.5, 0.5);
  -webkit-box-reflect: below 170px -webkit-gradient(linear, left top, left bottom, from(transparent), color-stop(0%, transparent), to(rgba(250, 250, 250, 0.0))); 
}

.cube {

  position: relative;
  margin: 0 auto;
  height: 100px;
  width: 100px;
  -webkit-transform-style: preserve-3d;
  -moz-transform-style: preserve-3d;
  -ms-transform-style: preserve-3d;
  -o-transform-style: preserve-3d;
  transform-style: preserve-3d;
  -webkit-transform: rotateX(136deg) rotateY(1122deg);
  -moz-transform: rotateX(136deg) rotateY(1122deg);
  -ms-transform: rotateX(136deg) rotateY(1122deg);
  -o-transform: rotateX(136deg) rotateY(1122deg);
  transform: rotateX(136deg) rotateY(1122deg); 
        }

.cube > div {
  overflow: hidden;
  position: absolute;
  opacity: 0.9;
  height: 200px;
  width: 200px;
  background-image: url("cubeface.png");
  -webkit-touch-callout: none;
  -moz-touch-callout: none;
  -ms-touch-callout: none;
  -o-touch-callout: none;
  touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -o-user-select: none;
  user-select: none; }

.cube > div > div.cube-image {
  width: 200px;
  height: 200px;
  -webkit-transform: rotate(180deg);
  -moz-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  -o-transform: rotate(180deg);
  transform: rotate(180deg);
  line-height: 200px;
  font-size: 80px;
  text-align: center;
  color: #1b9bd8;
  -webkit-transition: color 600ms;
  -moz-transition: color 600ms;
  -ms-transition: color 600ms;
  -o-transition: color 600ms;
  transition: color 600ms; }
  .cube > div > div.cube-image.active {
    color: red; }

.cube > div:hover {
  cursor: pointer; }

.cube > div:active {
  cursor: pointer; }

.cube > div:first-child {
  -webkit-transform: rotateX(90deg) translateZ(100px);
  -moz-transform: rotateX(90deg) translateZ(100px);
  -ms-transform: rotateX(90deg) translateZ(100px);
  -o-transform: rotateX(90deg) translateZ(100px);
  transform: rotateX(90deg) translateZ(100px);
  outline: 1px solid transparent; }

.cube > div:nth-child(2) {
  -webkit-transform: translateZ(100px);
  -moz-transform: translateZ(100px);
  -ms-transform: translateZ(100px);
  -o-transform: translateZ(100px);
  transform: translateZ(100px);
  outline: 1px solid transparent; }

.cube > div:nth-child(3) {
  -webkit-transform: rotateY(90deg) translateZ(100px);
  -moz-transform: rotateY(90deg) translateZ(100px);
  -ms-transform: rotateY(90deg) translateZ(100px);
  -o-transform: rotateY(90deg) translateZ(100px);
  transform: rotateY(90deg) translateZ(100px);
  outline: 1px solid transparent; }

.cube > div:nth-child(4) {
  -webkit-transform: rotateY(180deg) translateZ(100px);
  -moz-transform: rotateY(180deg) translateZ(100px);
  -ms-transform: rotateY(180deg) translateZ(100px);
  -o-transform: rotateY(180deg) translateZ(100px);
  transform: rotateY(180deg) translateZ(100px);
  outline: 1px solid transparent; }

.cube > div:nth-child(5) {
  -webkit-transform: rotateY(-90deg) translateZ(100px);
  -moz-transform: rotateY(-90deg) translateZ(100px);
  -ms-transform: rotateY(-90deg) translateZ(100px);
  -o-transform: rotateY(-90deg) translateZ(100px);
  transform: rotateY(-90deg) translateZ(100px);
  outline: 1px solid transparent; }

.cube > div:nth-child(6) {
  -webkit-transform: rotateX(-90deg) rotate(180deg) translateZ(100px);
  -moz-transform: rotateX(-90deg) rotate(180deg) translateZ(100px);
  -ms-transform: rotateX(-90deg) rotate(180deg) translateZ(100px);
  -o-transform: rotateX(-90deg) rotate(180deg) translateZ(100px);
  transform: rotateX(-90deg) rotate(180deg) translateZ(100px);
  outline: 1px solid transparent; }

object {
  opacity: 0.5; }

object:hover {
  opacity: 1; }

@media (max-width: 640px) {
  .viewport {
    -webkit-transform: scale(0.6, 0.6);
    -moz-transform: scale(0.6, 0.6);
    -ms-transform: scale(0.6, 0.6);
    -o-transform: scale(0.6, 0.6);
    transform: scale(0.6, 0.6); } }
        
        
        
.level1-circle, .level2-circle, .level3-circle{
  border-radius: 50%;
  border: 3px solid white;
  background: black;
  height: 50px;
  width: 50px;
  transform: rotate(180deg);
  transition: transform 1s;
}
.level1-circle:before{
  content:'';
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  background:inherit;
  border-radius:inherit;
}
.level1-circle{
  margin: 150px 250px;
  position: relative;
  z-index: 5;
}
.level2-circle, .level3-circle{
  position: relative;
  top: 137px;
  left: -3px;
  z-index: -1;
  transform: rotate(0deg);
}
.level1-arm, .level2-arm, .level3-arm{
  height: 100px;
  width: 30px;
  border: 3px solid white;
  border-top: none;
  border-bottom: none;  
  top: 89%;
  left: 14%;
}
.level1-arm{
  position: absolute;
  z-index: 2;
}
.level2-arm, .level3-arm{
  position: absolute;
  z-index: 3;
}
.level1-dot, .level2-dot, .level3-dot{
  border-radius: 50%;
  border: 3px solid white;
  height: 0px;
  width: 0px;
}
.level1-gear, .level2-gear, .level3-gear{
  border-radius: 50%;
  border: 3px dotted white;
  height: 6px;
  width: 6px;
  position: absolute;
  top: 19px;
  left: 19px;
  margin: 0; padding: 0;
}
.level2-pointer{
  position: absolute;
  top: 117px; left: -1px;
  height: 50px;
  width: 50px;
  border-right: 3px solid white;
  border-bottom: 3px solid white;
  transform: rotate(45deg);
  overflow: hidden;
  z-index: -2;
}
.level2-pointer:after{
  position: absolute;
  content: '';
  height: 100%; width: 100%;
  top: 1px; left: 0px;
  border-left: 4px solid white;
  transform: skew(-45deg);
  transform-origin: left bottom;
}

/* Auto Play */
.level1-circle.autoplay, .level2-circle.autoplay{
  animation: rotatearm 8s infinite;
}
@keyframes rotatearm{
  0%{transform: rotate(0deg);}
  50%{transform: rotate(180deg);}
  100%{transform: rotate(360deg);}
}
        

    </style>
	
</head>
<body>

  <div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s4"><a class="active" href="#test1">Overall Rover Status</a></li>
        <li class="tab col s4"><a href="#test2">Rover Arm Status</a></li>
        <li class="tab col s4"><a href="#test3">Scientific Data Status</a></li>
      </ul>
    </div>
    <div id="test1" class="col s12">
   
        

        <div id="wrapper">
  <div class="viewport">
    <div class="cube">
      <div class="side">
        <div class="cube-image"></div>
      </div>
      <div class="side">
        <div class="cube-image"></div>
      </div>
      <div class="side">
        <div class="cube-image"></div>
      </div>
      <div class="side">
        <div class="cube-image"></div>
      </div>
      <div class="side">
        <div class="cube-image"></div>
      </div>
      <div class="side">
        <div class="cube-image active"></div>
      </div>
    </div>
  </div>
    <br>
    <br>
    <div class="row center-align">
        <div class="col s4 center-align">
            <p class="white-text">100</p>
            <p class="white-text">100</p>
            <p class="white-text">100</p>
        </div>
        <div class="col s4 center-align">
             <p class="white-text">100</p>
            <p class="white-text">100</p>
            <p class="white-text">100</p>
        </div>
        <div class="col s4 center-align">
             <p class="white-text">100</p>
            <p class="white-text">100</p>
            <p class="white-text">100</p>
        </div>
    </div>
 
</div>

    </div>
    <div id="test2" class="col s12">
        <div id="arm">
        <div class="level1-circle">
  <div class="level1-gear">
    <div class="level1-dot"></div>
  </div>
  <div class="level1-arm"></div>
  <div class="level2-circle">
    <div class="level2-gear">
      <div class="level2-dot"></div>
    </div>
    <div class="level2-arm"></div>
    <div class="level2-circle">
    <div class="level2-gear">
      <div class="level2-dot"></div>
    </div>
    <div class="level2-arm"></div>
    <div class="level2-pointer"></div>
  </div>
  </div>
</div>
        </div>
    </div>
    <div id="test3" class="col s12"></div>
  </div>
    
     <div class="vxgplayer" 

id="vxg_media_player1" 

url="rtsp://192.168.0.10:554/user=admin&password=&channel=1&stream=0.sdp?" 

autostart controls avsync 

nmf-src="pnacl/Release/media_player.nmf" 

nmf-path="pnacl/Release/media_player.nmf" 

style = "height:100%; width:100%;"

></div> 
    
    <div id="map"></div>
                <canvas id="powergraph"></canvas>
    
    <div id="navcontainer" class="row">
        <br>
        <div class="col s2">
        <a class="btn btn-floating pulse dropdown-button" data-activates='dropdown1'>+</a>
        <a class="btn">Syncing...</a>

            </div>
        <div class="col s10">

   <ul id="navlist">

    <li><a>ARM Action</a> <a>Grip: True</a> <a>XYZ: (1,2,3)</a></li>
    <li><a href="#!">DRIVE Action</a></li>
    <li><a href="#!">HAND Action</a></li>
   </ul>
    </div>
</div>
    
  <ul id='dropdown1' class='dropdown-content'>
    <li><a href="#armmodal">ARM</a></li>
    <li><a href="#drivemodal">DRIVE</a></li>
    <li><a href="#handmodal">HAND</a></li>
    <li class="divider"></li>
    <li><a href="#missionmodal" class="red-text">MISSION</a></li>


  </ul>

    
   <!--Arm Modal Structure -->
  <div id="armmodal" class="modal">
    <div class="modal-content">
        <h4>Add a New Arm Task</h4>
        <a class='dropdown-button btn' href='#' data-activates='arm_task'>Select an Action</a>
         <ul id='arm_task' class='dropdown-content'>
             <li><a href="#!">Grip</a></li>
             <li><a href="#!">Rotate</a></li>
          </ul>
        
        <br>
        <br>
        
        <a class='dropdown-button btn' href='#' data-activates='grip_selection'>Select Grip Mode</a>
         <ul id='grip_selection' class='dropdown-content'>
             <li><a href="#!">True</a></li>
             <li><a href="#!">False</a></li>
          </ul>
        
        <div class="row">
            <div class="input-field col s4">
            <input placeholder="x coordinate" id="first_name" type="text" class="validate">
            </div>
            <div class="input-field col s4">
             <input placeholder="y coordinate" id="first_name" type="text" class="validate">
            </div>
            <div class="input-field col s4">
             <input placeholder="z coordinate" id="first_name" type="text" class="validate">
            </div>
        </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>
    
  
  <!--Drive Modal Structure -->
  <div id="drivemodal" class="modal">
    <div class="modal-content">
        
      <h4>Add a New Drive Task</h4>
          <a class='dropdown-button btn' href='#' data-activates='drive_task'>Select an Action</a>
          <ul id='drive_task' class='dropdown-content'>
             <li><a href="#!">Displacement</a></li>
             <li><a href="#!">GPS</a></li>
          </ul>
        <div class="input-field col s6">
          <input placeholder="Displacement Value" id="first_name" type="text" class="validate">
        </div>
        <div class="row">
            <div class="input-field col s4">
            <input placeholder="x coordinate" id="first_name" type="text" class="validate">
            </div>
            <div class="input-field col s4">
             <input placeholder="y coordinate" id="first_name" type="text" class="validate">
            </div>
            <div class="input-field col s4">
             <input placeholder="z coordinate" id="first_name" type="text" class="validate">
            </div>
        </div>
      
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>
    
  <!--Hand Modal Structure -->
  <div id="handmodal" class="modal">
    <div class="modal-content">
      <h4>Add a New Hand Task</h4>
         <a class='dropdown-button btn' href='#' data-activates='hand_task'>Select an Action</a>

         <ul id='hand_task' class='dropdown-content'>
             <li><a href="#!">Press</a></li>
             <li><a hrpef="#!">Lever</a></li>
             <li><a href="#!">Valve</a></li>
             <li><a href="#!">Drill</a></li>
          </ul>
      
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div
      
 <!--Mission Modal Structure -->
  <div id="missionmodal" class="modal">
    <div class="modal-content">
                <a class="btn btn-floating">+</a>

      <h4>Mission Management</h4>
         <div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s2"><a href="#mission1">Test 1</a></li>
        <li class="tab col s2"><a href="#mission2">Test 2</a></li>
        <li class="tab col s2"><a href="#mission3">Disabled Tab</a></li>
        <li class="tab col s2"><a href="#mission4">Test 4</a></li>
      </ul>
    </div>
    <div id="mission1" class="col s12"></div>
    <div id="mission2" class="col s12">Test 2</div>
    <div id="mission3" class="col s12">Test 3</div>
    <div id="mission4" class="col s12">Test 4</div>
  </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
    </div>
  </div>


    
    


            

    

    


    
    
    

    

       <script type="text/javascript" 

        src="vxgplayer-1.8.31.js"> </script> 

    
  
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
 <script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
    <script type="text/javascript" src="smoothie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
    <script src="map/leaflet/leaflet-src.js"></script>


    
    <script>
    $(document).ready(function(){
 
        console.log("Ready!");
            $('.modal').modal();
       var smoothie = new SmoothieChart({minValue: 0, maxValue: 1,
  grid: { strokeStyle:'rgb(2, 136, 169)', fillStyle:'rgb(0, 0, 0)',
          lineWidth: 1, millisPerLine: 250, verticalSections: 6, }
});
       smoothie.streamTo(document.getElementById("powergraph")); 
        var line1 = new TimeSeries();
var line2 = new TimeSeries();

// Add a random value to each line every second
setInterval(function() {
  line1.append(new Date().getTime(), Math.random());
  line2.append(new Date().getTime(), Math.random());
}, 1000);

// Add to SmoothieChart
smoothie.addTimeSeries(line1);
smoothie.addTimeSeries(line2);
        
        
function circle1Rotate() {
    $('.level1-circle').css({
      '-webkit-transform': 'rotate(' + Math.random()*180  + 'deg)',
      'transform': 'rotate(' + Math.random()*180  + 'deg)'
    });
}
function circle2Rotate(){
    $('.level2-circle').css({
      '-webkit-transform': 'rotate(' + Math.random()*-20  + 'deg)',
      'transform': 'rotate(' + Math.random()*-20  + 'deg)'
    });
  }

function circle3Rotate(){
    $('.level3-circle').css({
      '-webkit-transform': 'rotate(' + Math.random()*-30  + 'deg)',
      'transform': 'rotate(' + Math.random()*-30 + 'deg)'
    });
  }

function autoRotate(){
    circle1Rotate();
    circle2Rotate();
    circle3Rotate();
    console.log("Autorotate called");


}
        setInterval(autoRotate, 5000)
        
$( "#navlist" ).sortable();
    });
        
        var map = L.map('map').setView([38.4065206, -110.7935204], 4);
         L.tileLayer('map/ter_tiles/{z0}/{x0}/{x1}/{y0}/{y1}.png').addTo(map);
        var marsdesertresearch = L.marker([38.4065206, -110.7935204]).addTo(map).bindPopup("Mars Desert Research Station").openPopup();
        var roverIcon = L.icon({
            iconUrl: 'map/rover-icon.png',
            iconSize: [50, 50], // size of the icon
            iconAnchor: [25, 25], // point of the icon which will correspond to marker's location
            popupAnchor: [0, -51] 
        });
        L.marker([38.4165206, -110.8035204], {icon: roverIcon}).addTo(map);

    </script>

    <script>
    var events = new Events();
events.add = function(obj) {
  obj.events = { };
}
events.implement = function(fn) {
  fn.prototype = Object.create(Events.prototype);
}

function Events() {
  this.events = { };
}
Events.prototype.on = function(name, fn) {
  var events = this.events[name];
  if (events == undefined) {
    this.events[name] = [ fn ];
    this.emit('event:on', fn);
  } else {
    if (events.indexOf(fn) == -1) {
      events.push(fn);
      this.emit('event:on', fn);
    }
  }
  return this;
}
Events.prototype.once = function(name, fn) {
  var events = this.events[name];
  fn.once = true;
  if (!events) {
    this.events[name] = [ fn ];
    this.emit('event:once', fn);
  } else {
    if (events.indexOf(fn) == -1) {
      events.push(fn);
      this.emit('event:once', fn);
    }
  }
  return this;
}
Events.prototype.emit = function(name, args) {
  var events = this.events[name];
  if (events) {
    var i = events.length;
    while(i--) {
      if (events[i]) {
        events[i].call(this, args);
        if (events[i].once) {
          delete events[i];
        }
      }
    }
  }
  return this;
}
Events.prototype.unbind = function(name, fn) {
  if (name) {
    var events = this.events[name];
    if (events) {
      if (fn) {
        var i = events.indexOf(fn);
        if (i != -1) {
          delete events[i];
        }
      } else {
        delete this.events[name];
      }
    }
  } else {
    delete this.events;
    this.events = { };
  }
  return this;
}

var userPrefix;

var prefix = (function () {
  var styles = window.getComputedStyle(document.documentElement, ''),
    pre = (Array.prototype.slice
      .call(styles)
      .join('') 
      .match(/-(moz|webkit|ms)-/) || (styles.OLink === '' && ['', 'o'])
    )[1],
    dom = ('WebKit|Moz|MS|O').match(new RegExp('(' + pre + ')', 'i'))[1];
  userPrefix = {
    dom: dom,
    lowercase: pre,
    css: '-' + pre + '-',
    js: pre[0].toUpperCase() + pre.substr(1)
  };
})();

function bindEvent(element, type, handler) {
  if(element.addEventListener) {
    element.addEventListener(type, handler, false);
  } else {
    element.attachEvent('on' + type, handler);
  }
}

function Viewport(data) {
  events.add(this);

  var self = this;

  this.element = data.element;
  this.fps = data.fps;
  this.sensivity = data.sensivity;
  this.sensivityFade = data.sensivityFade;
  this.touchSensivity = data.touchSensivity;
  this.speed = data.speed;

  this.lastX = 0;
  this.lastY = 0;
  this.mouseX = 0;
  this.mouseY = 0;
  this.distanceX = 0;
  this.distanceY = 0;
  this.positionX = 0;
  this.positionY =0;
  this.torqueX = 0;
  this.torqueY = 0;

  this.down = false;
  this.upsideDown = false;

  this.previousPositionX = 0;
  this.previousPositionY = 0;

  this.currentSide = 0;
  this.calculatedSide = 0;


  bindEvent(document, 'mousedown', function() {
    self.down = true;
  });

  bindEvent(document, 'mouseup', function() {
    self.down = false;
  });
  
  bindEvent(document, 'keyup', function() {
    self.down = false;
  });

  bindEvent(document, 'mousemove', function(e) {
    self.mouseX = e.pageX;
    self.mouseY = e.pageY;
  });

  bindEvent(document, 'touchstart', function(e) {

    self.down = true;
    e.touches ? e = e.touches[0] : null;
    self.mouseX = e.pageX / self.touchSensivity;
    self.mouseY = e.pageY / self.touchSensivity;
    self.lastX  = self.mouseX;
    self.lastY  = self.mouseY;
  });

  bindEvent(document, 'touchmove', function(e) {
    if(e.preventDefault) { 
      e.preventDefault();
    }

    if(e.touches.length == 1) {

      e.touches ? e = e.touches[0] : null;

      self.mouseX = e.pageX / self.touchSensivity;
      self.mouseY = e.pageY / self.touchSensivity;

    }
  });

  bindEvent(document, 'touchend', function(e) {
    self.down = false;
  });  

  setInterval(this.animate.bind(this), this.fps);

}
events.implement(Viewport);
Viewport.prototype.animate = function() {

  this.distanceX = (this.mouseX - this.lastX);
  this.distanceY = (this.mouseY - this.lastY);

  this.lastX = this.mouseX;
  this.lastY = this.mouseY;

  if(this.down) {
    this.torqueX = this.torqueX * this.sensivityFade + (this.distanceX * this.speed - this.torqueX) * this.sensivity;
    this.torqueY = this.torqueY * this.sensivityFade + (this.distanceY * this.speed - this.torqueY) * this.sensivity;
  }

  if(Math.abs(this.torqueX) > 1.0 || Math.abs(this.torqueY) > 1.0) {
    if(!this.down) {
      this.torqueX *= this.sensivityFade;
      this.torqueY *= this.sensivityFade;
    }

    this.positionY -= this.torqueY;

    if(this.positionY > 360) {
      this.positionY -= 360;
    } else if(this.positionY < 0) {
      this.positionY += 360;
    }

    if(this.positionY > 90 && this.positionY < 270) {
      this.positionX -= this.torqueX;

      if(!this.upsideDown) {
        this.upsideDown = true;
        this.emit('upsideDown', { upsideDown: this.upsideDown });
      }

    } else {

      this.positionX += this.torqueX;

      if(this.upsideDown) {
        this.upsideDown = false;
        this.emit('upsideDown', { upsideDown: this.upsideDown });
      }
    }

    if(this.positionX > 360) {
      this.positionX -= 360;
    } else if(this.positionX < 0) {
      this.positionX += 360;
    }

    if(!(this.positionY >= 46 && this.positionY <= 130) && !(this.positionY >= 220 && this.positionY <= 308)) {
      if(this.upsideDown) {
        if(this.positionX >= 42 && this.positionX <= 130) {
          this.calculatedSide = 3;
        } else if(this.positionX >= 131 && this.positionX <= 223) {
          this.calculatedSide = 2;
        } else if(this.positionX >= 224 && this.positionX <= 314) {
          this.calculatedSide = 5;
        } else {
          this.calculatedSide = 4;
        }
      } else {
        if(this.positionX >= 42 && this.positionX <= 130) {
          this.calculatedSide = 5;
        } else if(this.positionX >= 131 && this.positionX <= 223) {
          this.calculatedSide = 4;
        } else if(this.positionX >= 224 && this.positionX <= 314) {
          this.calculatedSide = 3;
        } else {
          this.calculatedSide = 2;
        }
      }
    } else {
      if(this.positionY >= 46 && this.positionY <= 130) {
        this.calculatedSide = 6;
      }

      if(this.positionY >= 220 && this.positionY <= 308) {
        this.calculatedSide = 1;
      }
    }

    if(this.calculatedSide !== this.currentSide) {
      this.currentSide = this.calculatedSide;
      this.emit('sideChange');
    }

  }

  this.element.style[userPrefix.js + 'Transform'] = 'rotateX(' + this.positionY + 'deg) rotateY(' + this.positionX + 'deg)';

  if(this.positionY != this.previousPositionY || this.positionX != this.previousPositionX) {
    this.previousPositionY = this.positionY;
    this.previousPositionX = this.positionX;

    this.emit('rotate');

  }

}
var viewport = new Viewport({
  element: document.getElementsByClassName('cube')[0],
  fps: 20,
  sensivity: .1,
  sensivityFade: .93,
  speed: 2,
  touchSensivity: 1.5
});

function Cube(data) {
  var self = this;

  this.element = data.element;
  this.sides = this.element.getElementsByClassName('side');

  this.viewport = data.viewport;
  this.viewport.on('rotate', function() {
    self.rotateSides();
  });
  this.viewport.on('upsideDown', function(obj) {
    self.upsideDown(obj);
  });
  this.viewport.on('sideChange', function() {
    self.sideChange();
  });
}
Cube.prototype.rotateSides = function() {
  var viewport = this.viewport;
  if(viewport.positionY > 90 && viewport.positionY < 270) {
    this.sides[0].getElementsByClassName('cube-image')[0].style[userPrefix.js + 'Transform'] = 'rotate(' + (viewport.positionX + viewport.torqueX) + 'deg)';
    this.sides[5].getElementsByClassName('cube-image')[0].style[userPrefix.js + 'Transform'] = 'rotate(' + -(viewport.positionX + 180 + viewport.torqueX) + 'deg)';
  } else {
    this.sides[0].getElementsByClassName('cube-image')[0].style[userPrefix.js + 'Transform'] = 'rotate(' + (viewport.positionX - viewport.torqueX) + 'deg)';
    this.sides[5].getElementsByClassName('cube-image')[0].style[userPrefix.js + 'Transform'] = 'rotate(' + -(viewport.positionX + 180 - viewport.torqueX) + 'deg)';
  }
}
Cube.prototype.upsideDown = function(obj) {

  var deg = (obj.upsideDown == true) ? '180deg' : '0deg';
  var i = 5;

  while(i > 0 && --i) {
    this.sides[i].getElementsByClassName('cube-image')[0].style[userPrefix.js + 'Transform'] = 'rotate(' + deg + ')';
  }

}
Cube.prototype.sideChange = function() {

  for(var i = 0; i < this.sides.length; ++i) {
    this.sides[i].getElementsByClassName('cube-image')[0].className = 'cube-image';    
  }

  this.sides[this.viewport.currentSide - 1].getElementsByClassName('cube-image')[0].className = 'cube-image active';

}

new Cube({
  viewport: viewport,
  element: document.getElementsByClassName('cube')[0]
});</script>

    
</body>
</html>
